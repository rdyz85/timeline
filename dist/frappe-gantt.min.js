var Gantt=function(){"use strict";function t(e){"@babel/helpers - typeof";return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function s(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function a(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function r(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?a(Object(i),!0).forEach(function(e){s(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t,e,i){return(h=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,i){var n=[null];n.push.apply(n,e);var s=new(Function.bind.apply(t,n));return i&&o(s,i.prototype),s}).apply(null,arguments)}function u(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||l(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){if(t){if("string"==typeof t)return p(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?p(t,e):void 0}}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function c(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=l(t))){var e=0,i=function(){};return{s:i,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,s,a=!0,r=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){r=!0,s=t},f:function(){try{a||null==n.return||n.return()}finally{if(r)throw s}}}}var d={en:["January","February","March","April","May","June","July","August","September","October","November","December"],es:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],ru:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],ptBr:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],fr:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],tr:["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"],zh:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]};function g(t,e,i){var n=t,s=e,a=i;return n+="",s>>=0,a=String(void 0!==a?a:" "),n.length>s?String(n):((s-=n.length)>a.length&&(a+=a.repeat(s/a.length)),a.slice(0,s)+String(n))}var _={parse:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/[.:]/;if(t instanceof Date)return t;if("string"==typeof t){var n=t.split(" "),s=n[0].split(e).map(function(t){return parseInt(t,10)}),a=n[1]&&n[1].split(i);s[1]-=1;var r=s;return a&&a.length&&(4===a.length&&(a[3]="0.".concat(a[3]),a[3]=1e3*parseFloat(a[3])),r=r.concat(a)),h(Date,u(r))}return null},to_string:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(t instanceof Date))throw new TypeError("Invalid argument type");var i=this.get_date_values(t).map(function(t,e){var i=t;return 1===e&&(i+=1),g("".concat(i),6===e?3:2,"0")}),n="".concat(i[0],"-").concat(i[1],"-").concat(i[2]),s="".concat(i[3],":").concat(i[4],":").concat(i[5],".").concat(i[6]);return n+(e?" ".concat(s):"")},format:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD HH:mm:ss.SSS",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"en",n=this.get_date_values(t).map(function(t){return g(t,2,0)}),s={YYYY:n[0],MM:g(+n[1]+1,2,0),DD:n[2],HH:n[3],mm:n[4],ss:n[5],SSS:n[6],D:n[2],MMMM:d[i][+n[1]],MMM:d[i][+n[1]]},a=e,r=[];return Object.keys(s).sort(function(t,e){return e.length-t.length}).forEach(function(t){a.includes(t)&&(a=a.replace(t,"$".concat(r.length)),r.push(s[t]))}),r.forEach(function(t,e){a=a.replace("$".concat(e),t)}),a},diff:function(t,e){var i=t-e,n=i/1e3,s=n/60,a=s/60,r=a/24,o=r/30,h=o/12,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"day";return u.endsWith("s")||(u+="s"),Math.floor({milliseconds:i,seconds:n,minutes:s,hours:a,days:r,months:o,years:h}[u])},today:function(){var t=this.get_date_values(new Date).slice(0,3);return h(Date,u(t))},now:function(){return new Date},add:function(t,e,i){var n=parseInt(e,10),s=[t.getFullYear()+("year"===i?n:0),t.getMonth()+("month"===i?n:0),t.getDate()+("day"===i?n:0),t.getHours()+("hour"===i?n:0),t.getMinutes()+("minute"===i?n:0),t.getSeconds()+("second"===i?n:0),t.getMilliseconds()+("millisecond"===i?n:0)];return h(Date,s)},start_of:function(t,e){var i,n=(s(i={},"year",6),s(i,"month",5),s(i,"day",4),s(i,"hour",3),s(i,"minute",2),s(i,"second",1),s(i,"millisecond",0),i);function a(t){var i=n[e];return n[t]<=i}var r=[t.getFullYear(),a("year")?0:t.getMonth(),a("month")?1:t.getDate(),a("day")?0:t.getHours(),a("hour")?0:t.getMinutes(),a("minute")?0:t.getSeconds(),a("second")?0:t.getMilliseconds()];return h(Date,r)},clone:function(t){return h(Date,u(this.get_date_values(t)))},get_date_values:function(t){return[t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()]},get_days_in_month:function(t){var e=t.getMonth();if(1!==e)return[31,28,31,30,31,30,31,31,30,31,30,31][e];var i=t.getFullYear();return i%4==0&&i%100!=0||i%400==0?29:28}};function f(t,e){return"string"==typeof t?(e||document).querySelector(t):t||null}function y(t,e){var i=document.createElementNS("http://www.w3.org/2000/svg",t);for(var n in e){if("append_to"===n)e.append_to.appendChild(i);else"innerHTML"===n?i.innerHTML=e.innerHTML:i.setAttribute(n,e[n])}return i}function v(t,e,i,n){var s=function(t,e,i,n){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"0.4s",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"0.1s",r=t.querySelector("animate");if(r)return f.attr(r,{attributeName:e,from:i,to:n,dur:s,begin:"click + "+a}),t;var o,h=y("animate",{attributeName:e,from:i,to:n,dur:s,begin:a,calcMode:"spline",values:i+";"+n,keyTimes:"0; 1",keySplines:(o="ease-out",{ease:".25 .1 .25 1",linear:"0 0 1 1","ease-in":".42 0 1 1","ease-out":"0 0 .58 1","ease-in-out":".42 0 .58 1"}[o])});return t.appendChild(h),t}(t,e,i,n);if(s===t){var a=document.createEvent("HTMLEvents");a.initEvent("click",!0,!0),a.eventName="click",s.dispatchEvent(a)}}f.on=function(t,e,i,n){n?f.delegate(t,e,i,n):(n=i,f.bind(t,e,n))},f.off=function(t,e,i){t.removeEventListener(e,i)},f.bind=function(t,e,i){e.split(/\s+/).forEach(function(e){t.addEventListener(e,i)})},f.delegate=function(t,e,i,n){t.addEventListener(e,function(t){var e=t.target.closest(i);e&&(t.delegatedTarget=e,n.call(this,t,e))})},f.closest=function(t,e){return e?e.matches(t)?e:f.closest(t,e.parentNode):null},f.attr=function(e,i,n){if(!n&&"string"==typeof i)return e.getAttribute(i);if("object"===t(i)){for(var s=0,a=Object.keys(i);s<a.length;s++){var r=a[s];f.attr(e,r,i[r])}return null}return e.setAttribute(i,n),null};var m=function(){function t(i,n,s,a){e(this,t),this.set_defaults(i,n,s,a),this.prepare()}return n(t,[{key:"set_defaults",value:function(t,e,i,n){this.action_completed=!1,this.gantt=t,this.bar=i,this.task=e,this.href=n.href,this.date=n.date}},{key:"prepare",value:function(){this.prepare_values()}},{key:"prepare_values",value:function(){this.invalid=this.task.invalid,this.height=this.gantt.options.bar_height,this.x=this.compute_x(),this.y=this.compute_y(),this.width=16,this.group=this.bar.milestone_group}},{key:"draw",value:function(){this.draw_image()}},{key:"draw_image",value:function(){this.$image=y("image",{x:this.x,y:this.y,width:this.width,height:this.width,href:this.href,append_to:this.group})}},{key:"compute_x",value:function(){var t=this.gantt.options,e=t.step,i=t.column_width,n=this.date,s=this.gantt.gantt_start,a=_.diff(n,s,"hour")/e*i;this.gantt.view_is("Month")&&(a=_.diff(n,s,"day")*i/30);return a}},{key:"compute_y",value:function(){return this.gantt.options.header_height+this.gantt.options.padding+this.task._index*(this.height+this.gantt.options.padding)}}]),t}(),w=function(){function t(i,n){e(this,t),this.set_defaults(i,n),this.prepare(),this.draw(),this.bind()}return n(t,[{key:"set_defaults",value:function(t,e){this.action_completed=!1,this.gantt=t,this.task=e,this.milestones=[]}},{key:"make_milestones",value:function(){this.task.milestones&&(this.milestones=this.task.milestones.map(function(t){return new m(this.gantt,this.task,this,t)}.bind(this)))}},{key:"prepare",value:function(){this.prepare_values(),this.make_milestones()}},{key:"prepare_values",value:function(){this.invalid=this.task.invalid,this.height=this.task.height||this.gantt.options.bar_height,this.x=this.compute_x(),this.y=this.compute_y(),this.corner_radius=this.gantt.options.bar_corner_radius,this.duration=_.diff(this.task.end,this.task.start,"hour")/this.gantt.options.step,this.width=this.gantt.options.column_width*this.duration,this.progress_width=this.gantt.options.column_width*this.duration*(this.task.progress/100)||0,this.group=y("g",{class:"bar-wrapper ".concat(this.task.custom_class||""),"data-id":this.task.id}),this.bar_group=y("g",{class:"bar-group",append_to:this.group}),this.handle_group=y("g",{class:"handle-group",append_to:this.group}),this.milestone_group=y("g",{class:"milestone-wrapper ".concat(this.task.custom_class||""),"data-id":this.task.id})}},{key:"draw",value:function(){this.draw_bar(),this.draw_progress_bar(),this.draw_label(),this.draw_milestones()}},{key:"draw_milestones",value:function(){this.milestones.forEach(function(t){return t.draw()})}},{key:"draw_bar",value:function(){this.$bar=y("rect",{x:this.x,y:this.y,width:this.width,height:this.height,rx:this.corner_radius,ry:this.corner_radius,class:"bar",append_to:this.bar_group}),v(this.$bar,"width",0,this.width),this.invalid&&this.$bar.classList.add("bar-invalid")}},{key:"draw_progress_bar",value:function(){this.invalid||(this.$bar_progress=y("rect",{x:this.x,y:this.y,width:this.progress_width,height:this.height,rx:this.corner_radius,ry:this.corner_radius,class:"bar-progress",append_to:this.bar_group}),v(this.$bar_progress,"width",0,this.progress_width))}},{key:"draw_label",value:function(){var t=this;y("text",{x:this.x+this.width/2,y:this.y+this.height/2,innerHTML:this.task.name,class:"bar-label",append_to:this.bar_group}),requestAnimationFrame(function(){return t.update_label_position()})}},{key:"get_progress_polygon_points",value:function(){var t=this.$bar_progress;return[t.getEndX()-5,t.getY()+t.getHeight(),t.getEndX()+5,t.getY()+t.getHeight(),t.getEndX(),t.getY()+t.getHeight()-8.66]}},{key:"bind",value:function(){this.invalid||this.setup_click_event()}},{key:"setup_click_event",value:function(){var t=this;f.on(this.group,"focus ".concat(this.gantt.options.popup_trigger),function(e){t.action_completed||("click"===e.type&&t.gantt.trigger_event("click",[t.task]),t.gantt.unselect_all(),t.group.classList.toggle("active"),t.show_popup())})}},{key:"show_popup",value:function(){if(!this.gantt.bar_being_dragged){var t=_.format(this.task.start,"MMM D",this.gantt.options.language),e=_.format(_.add(this.task.end,-1,"second"),"MMM D",this.gantt.options.language),i="".concat(t," - ").concat(e);this.gantt.show_popup({target_element:this.$bar,title:this.task.name,subtitle:i,task:this.task})}}},{key:"set_action_completed",value:function(){var t=this;this.action_completed=!0,setTimeout(function(){t.action_completed=!1},1e3)}},{key:"compute_progress",value:function(){var t=this.$bar_progress.getWidth()/this.$bar.getWidth()*100;return parseInt(t,10)}},{key:"compute_x",value:function(){var t=this.gantt.options,e=t.step,i=t.column_width,n=this.task.start,s=this.gantt.grid.start,a=_.diff(n,s,"hour")/e*i;this.gantt.grid.view_is("Month")&&(a=_.diff(n,s,"day")*i/30);return a}},{key:"compute_y",value:function(){for(var t=0,e=this.gantt.tasks.tasks.indexOf(this.task),i=0;i<e;i++)t+=this.gantt.tasks.tasks[i].height;return t+=e*this.gantt.options.padding,this.gantt.options.header_height+this.gantt.options.padding+t}},{key:"update_label_position",value:function(){var t=this.$bar,e=this.group.querySelector(".bar-label");e.getBBox().width>t.getWidth()?(e.classList.add("big"),e.setAttribute("x",t.getX()+t.getWidth()+5)):(e.classList.remove("big"),e.setAttribute("x",t.getX()+t.getWidth()/2))}}]),t}();var b=function(){function t(i,n){e(this,t),this.gantt=i,this.start=_.parse(n.start),this.end=_.parse(n.end),this.progress=n.progress,this.name=n.name,this.height=n.height||this.gantt.options.bar_height,_.diff(this.end,this.start,"year")>10&&(this.end=null),this.start||this.end||(this.start=_.today(),this.end=_.add(this.start,2,"day")),!this.start&&this.end&&(this.start=_.add(this.end,-2,"day")),this.start&&!this.end&&(this.end=_.add(this.start,2,"day")),_.get_date_values(this.end).slice(3).every(function(t){return 0===t})&&(this.end=_.add(this.end,24,"hour")),this.start&&this.end||(this.invalid=!0),this.id=n.id,this.id||(this.id=this.name+"_"+Math.random().toString(36).slice(2,12))}return n(t,[{key:"render",value:function(){this.make_bars()}},{key:"make_bars",value:function(){var t=new w(this.gantt,this);this.gantt.layers.bar.appendChild(t.group),this.gantt.layers.bar.appendChild(t.milestone_group)}}]),t}(),k=function(){function t(i,n){e(this,t),this.gantt=i,this.tasks=n.map(function(t){return new b(i,t)})}return n(t,[{key:"getBoundingDates",value:function(){var t,e=null,i=null,n=c(this.tasks);try{for(n.s();!(t=n.n()).done;){var s=t.value;(!e||s.start<e)&&(e=s.start),(!i||s.end>i)&&(i=s.end)}}catch(t){n.e(t)}finally{n.f()}return{gantt_start:e,gantt_end:i}}},{key:"render",value:function(){this.tasks.forEach(function(t){return t.render()})}},{key:"getHeight",value:function(){var t,e=this.gantt.options.padding*this.tasks.length,i=c(this.tasks);try{for(i.s();!(t=i.n()).done;){e+=t.value.height}}catch(t){i.e(t)}finally{i.f()}return e}}]),t}(),M=function(){function t(i,n){e(this,t),this.parent=i,this.custom_html=n,this.make()}return n(t,[{key:"make",value:function(){this.parent.innerHTML='\n            <div class="title"></div>\n            <div class="subtitle"></div>\n            <div class="pointer"></div>\n        ',this.hide(),this.title=this.parent.querySelector(".title"),this.subtitle=this.parent.querySelector(".subtitle"),this.pointer=this.parent.querySelector(".pointer")}},{key:"show",value:function(t){if(!t.target_element)throw new Error("target_element is required to show popup");t.position||(t.position="left");var e,i=t.target_element;if(this.custom_html){var n=this.custom_html(t.task);n+='<div class="pointer"></div>',this.parent.innerHTML=n,this.pointer=this.parent.querySelector(".pointer")}else this.title.innerHTML=t.title,this.subtitle.innerHTML=t.subtitle,this.parent.style.width=this.parent.clientWidth+"px";i instanceof HTMLElement?e=i.getBoundingClientRect():i instanceof SVGElement&&(e=t.target_element.getBBox()),"left"===t.position&&(this.parent.style.left=e.x+(e.width+10)+"px",this.parent.style.top=e.y+"px",this.pointer.style.transform="rotateZ(90deg)",this.pointer.style.left="-7px",this.pointer.style.top="2px"),this.parent.style.opacity=1}},{key:"hide",value:function(){this.parent.style.opacity=0}}]),t}(),D={VIEW_MODE:{QUARTER_DAY:"Quarter Day",HALF_DAY:"Half Day",DAY:"Day",WEEK:"Week",MONTH:"Month",YEAR:"Year"}},x=function(){function t(i){e(this,t),this.gantt=i,this.start=null,this.end=null}return n(t,[{key:"render",value:function(){this.make_grid_background(),this.make_grid_rows(),this.make_grid_header(),this.make_grid_ticks(),this.make_grid_highlights(),this.make_dates()}},{key:"view_is",value:function(t){var e=this;return"string"==typeof t?this.gantt.options.view_mode===t:!!Array.isArray(t)&&t.some(function(t){return e.gantt.options.view_mode===t})}},{key:"setup_dates",value:function(){this.setup_gantt_dates(),this.setup_date_values()}},{key:"setup_gantt_dates",value:function(){var t=this.gantt.tasks.getBoundingDates(),e=t.gantt_start,i=t.gantt_end;this.start=e,this.end=i,this.start=_.start_of(this.start,"day"),this.end=_.start_of(this.end,"day"),this.view_is([D.QUARTER_DAY,D.HALF_DAY])?(this.start=_.add(this.start,-7,"day"),this.end=_.add(this.end,7,"day")):this.view_is(D.MONTH)?(this.start=_.start_of(this.start,"year"),this.end=_.add(this.end,1,"year")):this.view_is(D.YEAR)?(this.start=_.add(this.start,-2,"year"),this.end=_.add(this.end,2,"year")):(this.start=_.add(this.start,-1,"month"),this.end=_.add(this.end,1,"month"))}},{key:"setup_date_values",value:function(){this.dates=[];for(var t=null;null===t||t<this.end;)t=t?this.view_is(D.YEAR)?_.add(t,1,"year"):this.view_is(D.MONTH)?_.add(t,1,"month"):_.add(t,this.gantt.options.step,"hour"):_.clone(this.start),this.dates.push(t)}},{key:"make_grid_background",value:function(){var t=this.dates.length*this.gantt.options.column_width,e=this.gantt.tasks.getHeight(),i=this.gantt.options.header_height+this.gantt.options.padding+e;y("rect",{x:0,y:0,width:t,height:i,class:"grid-background",append_to:this.gantt.layers.grid}),f.attr(this.gantt.$svg,{height:i,width:"100%"})}},{key:"make_grid_rows",value:function(){var t,e=y("g",{append_to:this.gantt.layers.grid}),i=y("g",{append_to:this.gantt.layers.grid}),n=this.dates.length*this.gantt.options.column_width,s=this.gantt.options.header_height+this.gantt.options.padding/2,a=c(this.gantt.tasks.tasks);try{for(a.s();!(t=a.n()).done;){var r=(t.value.height||this.gantt.options.bar_height)+this.gantt.options.padding;y("rect",{x:0,y:s,width:n,height:r,class:"grid-row",append_to:e}),y("line",{x1:0,y1:s+r,x2:n,y2:s+r,class:"row-line",append_to:i}),s+=r}}catch(t){a.e(t)}finally{a.f()}}},{key:"make_grid_header",value:function(){y("rect",{x:0,y:0,width:this.dates.length*this.gantt.options.column_width,height:this.gantt.options.header_height+10,class:"grid-header",append_to:this.gantt.layers.grid})}},{key:"make_grid_ticks",value:function(){var t,e=0,i=this.gantt.options.header_height+this.gantt.options.padding/2,n=this.gantt.tasks.getHeight(),s=c(this.dates);try{for(s.s();!(t=s.n()).done;){var a=t.value,r="tick";this.view_is(D.DAY)&&1===a.getDate()&&(r+=" thick"),this.view_is(D.WEEK)&&a.getDate()>=1&&a.getDate()<8&&(r+=" thick"),this.view_is(D.MONTH)&&(a.getMonth()+1)%3==0&&(r+=" thick"),y("path",{d:"M ".concat(e," ").concat(i," v ").concat(n),class:r,append_to:this.gantt.layers.grid}),this.view_is(D.MONTH)?e+=_.get_days_in_month(a)*this.gantt.options.column_width/30:e+=this.gantt.options.column_width}}catch(t){s.e(t)}finally{s.f()}}},{key:"make_grid_highlights",value:function(){if(this.view_is(D.DAY)){var t=_.diff(_.today(),this.start,"hour")/this.gantt.options.step*this.gantt.options.column_width,e=this.gantt.options.column_width,i=this.gantt.tasks.getHeight();y("rect",{x:t,y:0,width:e,height:this.gantt.options.header_height+this.gantt.options.padding/2+i,class:"today-highlight",append_to:this.gantt.layers.grid})}}},{key:"make_dates",value:function(){var t,e=c(this.get_dates_to_draw());try{for(e.s();!(t=e.n()).done;){var i=t.value;if(y("text",{x:i.lower_x,y:i.lower_y,innerHTML:i.lower_text,class:"lower-text",append_to:this.gantt.layers.date}),i.upper_text){var n=y("text",{x:i.upper_x,y:i.upper_y,innerHTML:i.upper_text,class:"upper-text",append_to:this.gantt.layers.date});n.getBBox().x2>this.gantt.layers.grid.getBBox().width&&n.remove()}}}catch(t){e.e(t)}finally{e.f()}}},{key:"get_dates_to_draw",value:function(){var t=this,e=null;return this.dates.map(function(i,n){var s=t.get_date_info(i,e,n);return e=i,s})}},{key:"get_date_info",value:function(t,e,i){e||(e=_.add(t,1,"year"));var n={"Quarter Day_lower":_.format(t,"HH",this.gantt.options.language),"Half Day_lower":_.format(t,"HH",this.gantt.options.language),Day_lower:t.getDate()!==e.getDate()?_.format(t,"D",this.gantt.options.language):"",Week_lower:t.getMonth()!==e.getMonth()?_.format(t,"D MMM",this.gantt.options.language):_.format(t,"D",this.gantt.options.language),Month_lower:_.format(t,"MMMM",this.gantt.options.language),Year_lower:_.format(t,"YYYY",this.gantt.options.language),"Quarter Day_upper":t.getDate()!==e.getDate()?_.format(t,"D MMM",this.gantt.options.language):"","Half Day_upper":t.getDate()!==e.getDate()?t.getMonth()!==e.getMonth()?_.format(t,"D MMM",this.gantt.options.language):_.format(t,"D",this.gantt.options.language):"",Day_upper:t.getMonth()!==e.getMonth()?_.format(t,"MMMM",this.gantt.options.language):"",Week_upper:t.getMonth()!==e.getMonth()?_.format(t,"MMMM",this.gantt.options.language):"",Month_upper:t.getFullYear()!==e.getFullYear()?_.format(t,"YYYY",this.gantt.options.language):"",Year_upper:t.getFullYear()!==e.getFullYear()?_.format(t,"YYYY",this.gantt.options.language):""},s={x:i*this.gantt.options.column_width,lower_y:this.gantt.options.header_height,upper_y:this.gantt.options.header_height-25},a={"Quarter Day_lower":4*this.gantt.options.column_width/2,"Quarter Day_upper":0,"Half Day_lower":2*this.gantt.options.column_width/2,"Half Day_upper":0,Day_lower:this.gantt.options.column_width/2,Day_upper:30*this.gantt.options.column_width/2,Week_lower:0,Week_upper:4*this.gantt.options.column_width/2,Month_lower:this.gantt.options.column_width/2,Month_upper:12*this.gantt.options.column_width/2,Year_lower:this.gantt.options.column_width/2,Year_upper:30*this.gantt.options.column_width/2};return{upper_text:n["".concat(this.gantt.options.view_mode,"_upper")],lower_text:n["".concat(this.gantt.options.view_mode,"_lower")],upper_x:s.x+a["".concat(this.gantt.options.view_mode,"_upper")],upper_y:s.upper_y,lower_x:s.x+a["".concat(this.gantt.options.view_mode,"_lower")],lower_y:s.lower_y}}}]),t}();return SVGElement.prototype.getX=function(){return+this.getAttribute("x")},SVGElement.prototype.getY=function(){return+this.getAttribute("y")},SVGElement.prototype.getWidth=function(){return+this.getAttribute("width")},SVGElement.prototype.getHeight=function(){return+this.getAttribute("height")},SVGElement.prototype.getEndX=function(){return this.getX()+this.getWidth()},function(){function t(i,n,s){e(this,t),this.setup_wrapper(i),this.setup_options(s),this.grid=new x(this),this.tasks=new k(this,n),this.change_view_mode(),this.bind_events()}return n(t,[{key:"setup_wrapper",value:function(t){var e,i;if("string"==typeof t&&(t=document.querySelector(t)),t instanceof HTMLElement)i=t,e=t.querySelector("svg");else{if(!(t instanceof SVGElement))throw new TypeError("Frappé Gantt only supports usage of a string CSS selector, HTML DOM element or SVG DOM element for the 'element' parameter");e=t}e?(this.$svg=e,this.$svg.classList.add("gantt")):this.$svg=y("svg",{append_to:i,class:"gantt"}),this.$container=document.createElement("div"),this.$container.classList.add("gantt-container"),this.$svg.parentElement.appendChild(this.$container),this.$container.appendChild(this.$svg),this.popup_wrapper=document.createElement("div"),this.popup_wrapper.classList.add("popup-wrapper"),this.$container.appendChild(this.popup_wrapper)}},{key:"setup_options",value:function(t){var e={header_height:50,column_width:30,step:24,view_modes:u(Object.values(D)),bar_height:20,bar_corner_radius:3,padding:18,view_mode:"Day",date_format:"YYYY-MM-DD",popup_trigger:"click",custom_popup_html:null,language:"en"};this.options=r(r({},e),t)}},{key:"refresh",value:function(t){this.tasks=new k(t,this.options),this.change_view_mode()}},{key:"change_view_mode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.view_mode;this.update_view_scale(t),this.grid.setup_dates(),this.render(),this.trigger_event("view_change",[t])}},{key:"update_view_scale",value:function(t){this.options.view_mode=t,t===D.DAY?(this.options.step=24,this.options.column_width=38):t===D.HALF_DAY?(this.options.step=12,this.options.column_width=38):t===D.QUARTER_DAY?(this.options.step=6,this.options.column_width=38):t===D.WEEK?(this.options.step=168,this.options.column_width=140):t===D.MONTH?(this.options.step=720,this.options.column_width=120):t===D.YEAR&&(this.options.step=8760,this.options.column_width=120)}},{key:"bind_events",value:function(){this.bind_grid_click()}},{key:"render",value:function(){this.clear(),this.setup_layers(),this.grid.render(),this.tasks.render(),this.set_width(),this.set_scroll_position()}},{key:"setup_layers",value:function(){this.layers={};for(var t=0,e=["grid","date","progress","bar","details"];t<e.length;t++){var i=e[t];this.layers[i]=y("g",{class:i,append_to:this.$svg})}}},{key:"set_width",value:function(){var t=this.$svg.getBoundingClientRect().width,e=this.$svg.querySelector(".grid .grid-row").getAttribute("width");t<e&&this.$svg.setAttribute("width",e)}},{key:"set_scroll_position",value:function(){var t=this.$svg.parentElement;if(t){var e=_.diff(this.get_oldest_starting_date(),this.grid.start,"hour")/this.options.step*this.options.column_width-this.options.column_width;t.scrollLeft=e}}},{key:"bind_grid_click",value:function(){var t=this;f.on(this.$svg,this.options.popup_trigger,".grid-row, .grid-header",function(){t.unselect_all(),t.hide_popup()})}},{key:"unselect_all",value:function(){u(this.$svg.querySelectorAll(".bar-wrapper")).forEach(function(t){t.classList.remove("active")})}},{key:"show_popup",value:function(t){this.popup||(this.popup=new M(this.popup_wrapper,this.options.custom_popup_html)),this.popup.show(t)}},{key:"hide_popup",value:function(){return this.popup&&this.popup.hide()}},{key:"trigger_event",value:function(t,e){this.options["on_"+t]&&this.options["on_"+t].apply(null,e)}},{key:"get_oldest_starting_date",value:function(){return this.tasks.tasks.map(function(t){return t.start}).reduce(function(t,e){return e<=t?e:t})}},{key:"clear",value:function(){this.$svg.innerHTML=""}}]),t}()}();
