var Gantt=function(){"use strict";function t(e){"@babel/helpers - typeof";return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function s(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function a(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?s(Object(i),!0).forEach(function(e){r(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function p(t,e,i){return(p=l()?Reflect.construct:function(t,e,i){var n=[null];n.push.apply(n,e);var r=new(Function.bind.apply(t,n));return i&&u(r,i.prototype),r}).apply(null,arguments)}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t){var e=l();return function(){var i,n,r=h(t);if(e){var s=h(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return!(n=i)||"object"!=typeof n&&"function"!=typeof n?c(this):n}}function g(t){return function(t){if(Array.isArray(t))return _(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||f(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,e){if(t){if("string"==typeof t)return _(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_(t,e):void 0}}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function v(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=f(t))){var e=0,i=function(){};return{s:i,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,r,s=!0,a=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,r=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw r}}}}var y={en:["January","February","March","April","May","June","July","August","September","October","November","December"],es:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],ru:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],ptBr:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],fr:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],tr:["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"],zh:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]};function m(t,e,i){var n=t,r=e,s=i;return n+="",r>>=0,s=String(void 0!==s?s:" "),n.length>r?String(n):((r-=n.length)>s.length&&(s+=s.repeat(r/s.length)),s.slice(0,r)+String(n))}var w={parse:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/[.:]/;if(t instanceof Date)return t;if("string"==typeof t){var n=t.split(" "),r=n[0].split(e).map(function(t){return parseInt(t,10)}),s=n[1]&&n[1].split(i);r[1]-=1;var a=r;return s&&s.length&&(4===s.length&&(s[3]="0.".concat(s[3]),s[3]=1e3*parseFloat(s[3])),a=a.concat(s)),p(Date,g(a))}return null},to_string:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(t instanceof Date))throw new TypeError("Invalid argument type");var i=this.get_date_values(t).map(function(t,e){var i=t;return 1===e&&(i+=1),m("".concat(i),6===e?3:2,"0")}),n="".concat(i[0],"-").concat(i[1],"-").concat(i[2]),r="".concat(i[3],":").concat(i[4],":").concat(i[5],".").concat(i[6]);return n+(e?" ".concat(r):"")},format:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD HH:mm:ss.SSS",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"en",n=this.get_date_values(t).map(function(t){return m(t,2,0)}),r={YYYY:n[0],MM:m(+n[1]+1,2,0),DD:n[2],HH:n[3],mm:n[4],ss:n[5],SSS:n[6],D:n[2],MMMM:y[i][+n[1]],MMM:y[i][+n[1]]},s=e,a=[];return Object.keys(r).sort(function(t,e){return e.length-t.length}).forEach(function(t){s.includes(t)&&(s=s.replace(t,"$".concat(a.length)),a.push(r[t]))}),a.forEach(function(t,e){s=s.replace("$".concat(e),t)}),s},diff:function(t,e){var i=t-e,n=i/1e3,r=n/60,s=r/60,a=s/24,o=a/30,h=o/12,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"day";return u.endsWith("s")||(u+="s"),Math.floor({milliseconds:i,seconds:n,minutes:r,hours:s,days:a,months:o,years:h}[u])},today:function(){var t=this.get_date_values(new Date).slice(0,3);return p(Date,g(t))},now:function(){return new Date},add:function(t,e,i){var n=parseInt(e,10),r=[t.getFullYear()+("year"===i?n:0),t.getMonth()+("month"===i?n:0),t.getDate()+("day"===i?n:0),t.getHours()+("hour"===i?n:0),t.getMinutes()+("minute"===i?n:0),t.getSeconds()+("second"===i?n:0),t.getMilliseconds()+("millisecond"===i?n:0)];return p(Date,r)},start_of:function(t,e){var i,n=(r(i={},"year",6),r(i,"month",5),r(i,"day",4),r(i,"hour",3),r(i,"minute",2),r(i,"second",1),r(i,"millisecond",0),i);function s(t){var i=n[e];return n[t]<=i}var a=[t.getFullYear(),s("year")?0:t.getMonth(),s("month")?1:t.getDate(),s("day")?0:t.getHours(),s("hour")?0:t.getMinutes(),s("minute")?0:t.getSeconds(),s("second")?0:t.getMilliseconds()];return p(Date,a)},clone:function(t){return p(Date,g(this.get_date_values(t)))},get_date_values:function(t){return[t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()]},get_days_in_month:function(t){var e=t.getMonth();if(1!==e)return[31,28,31,30,31,30,31,31,30,31,30,31][e];var i=t.getFullYear();return i%4==0&&i%100!=0||i%400==0?29:28}};function b(t,e){return"string"==typeof t?(e||document).querySelector(t):t||null}function k(t,e){var i=document.createElementNS("http://www.w3.org/2000/svg",t);for(var n in e){if("append_to"===n)e.append_to.appendChild(i);else"innerHTML"===n?i.innerHTML=e.innerHTML:i.setAttribute(n,e[n])}return i}function O(t,e,i,n){var r=function(t,e,i,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"0.4s",s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"0.1s",a=t.querySelector("animate");if(a)return b.attr(a,{attributeName:e,from:i,to:n,dur:r,begin:"click + "+s}),t;var o,h=k("animate",{attributeName:e,from:i,to:n,dur:r,begin:s,calcMode:"spline",values:i+";"+n,keyTimes:"0; 1",keySplines:(o="ease-out",{ease:".25 .1 .25 1",linear:"0 0 1 1","ease-in":".42 0 1 1","ease-out":"0 0 .58 1","ease-in-out":".42 0 .58 1"}[o])});return t.appendChild(h),t}(t,e,i,n);if(r===t){var s=document.createEvent("HTMLEvents");s.initEvent("click",!0,!0),s.eventName="click",r.dispatchEvent(s)}}b.on=function(t,e,i,n){n?b.delegate(t,e,i,n):(n=i,b.bind(t,e,n))},b.off=function(t,e,i){t.removeEventListener(e,i)},b.bind=function(t,e,i){e.split(/\s+/).forEach(function(e){t.addEventListener(e,i)})},b.delegate=function(t,e,i,n){t.addEventListener(e,function(t){var e=t.target.closest(i);e&&(t.delegatedTarget=e,n.call(this,t,e))})},b.closest=function(t,e){return e?e.matches(t)?e:b.closest(t,e.parentNode):null},b.attr=function(e,i,n){if(!n&&"string"==typeof i)return e.getAttribute(i);if("object"===t(i)){for(var r=0,s=Object.keys(i);r<s.length;r++){var a=s[r];b.attr(e,a,i[a])}return null}return e.setAttribute(i,n),null};var M=function(){function t(i){e(this,t),this.gantt=i}return n(t,[{key:"getOption",value:function(t){return this.gantt.options[t]}},{key:"getLayer",value:function(t){return this.gantt.layers[t]}},{key:"getTasks",value:function(){return this.gantt.tasks}},{key:"getTaskIdx",value:function(t){var e=this.getTasks().entries();return t<e.length?e[t]:null}}]),t}(),D=function(t){o(r,M);var i=d(r);function r(t,n,s){var a;return e(this,r),(a=i.call(this,t)).set_defaults(n,s),a.prepare_values(),a.draw(),a}return n(r,[{key:"set_defaults",value:function(t,e){this.action_completed=!1,this.task=t,this.href=e.href,this.date=e.date,this.height=e.height||this.getOption("bar_height")}},{key:"prepare_values",value:function(){this.invalid=this.task.invalid,this.x=this.compute_x(),this.y=this.compute_y(),this.width=16,this.group=this.task.milestone_group}},{key:"draw",value:function(){this.$image=k("image",{x:this.x,y:this.y,width:this.width,height:this.width,href:this.href,append_to:this.group})}},{key:"compute_x",value:function(){var t=this.getOption("step"),e=this.getOption("column_width"),i=this.date,n=this.gantt.grid.start,r=w.diff(i,n,"hour")/t*e;this.gantt.grid.view_is("Month")&&(r=w.diff(i,n,"day")*e/30);return r}},{key:"compute_y",value:function(){var t=this.getTasks().entries().indexOf(this.task);return this.getOption("header_height")+this.getOption("padding")+t*(this.height+this.getOption("padding"))}}]),r}(),x=function(t){o(r,M);var i=d(r);function r(t,n){var s;return e(this,r),(s=i.call(this,t)).set_defaults(n),s.prepare_values(),s.draw(),s.bind(),s}return n(r,[{key:"set_defaults",value:function(t){this.action_completed=!1,this.task=t}},{key:"prepare_values",value:function(){this.invalid=this.task.invalid,this.height=this.task.height||this.getOption("bar_height"),this.x=this.compute_x(),this.y=this.compute_y(),this.corner_radius=this.getOption("bar_corner_radius"),this.duration=w.diff(this.task.end,this.task.start,"hour")/this.getOption("step"),this.width=this.getOption("column_width")*this.duration,this.progress_width=this.getOption("column_width")*this.duration*(this.task.progress/100)||0,this.group=k("g",{class:"bar-wrapper ".concat(this.task.custom_class||""),"data-id":this.task.id}),this.bar_group=k("g",{class:"bar-group",append_to:this.group})}},{key:"draw",value:function(){this.draw_bar(),this.draw_progress_bar(),this.draw_label()}},{key:"draw_bar",value:function(){this.$bar=k("rect",{x:this.x,y:this.y,width:this.width,height:this.height,rx:this.corner_radius,ry:this.corner_radius,class:"bar",append_to:this.bar_group}),O(this.$bar,"width",0,this.width),this.invalid&&this.$bar.classList.add("bar-invalid")}},{key:"draw_progress_bar",value:function(){this.invalid||(this.$bar_progress=k("rect",{x:this.x,y:this.y,width:this.progress_width,height:this.height,rx:this.corner_radius,ry:this.corner_radius,class:"bar-progress",append_to:this.bar_group}),O(this.$bar_progress,"width",0,this.progress_width))}},{key:"draw_label",value:function(){var t=this;k("text",{x:this.x+this.width/2,y:this.y+this.height/2,innerHTML:this.task.name,class:"bar-label",append_to:this.bar_group}),requestAnimationFrame(function(){return t.update_label_position()})}},{key:"get_progress_polygon_points",value:function(){var t=this.$bar_progress;return[t.getEndX()-5,t.getY()+t.getHeight(),t.getEndX()+5,t.getY()+t.getHeight(),t.getEndX(),t.getY()+t.getHeight()-8.66]}},{key:"bind",value:function(){this.invalid||this.setup_click_event()}},{key:"setup_click_event",value:function(){var t=this;b.on(this.group,"focus ".concat(this.getOption("popup_trigger")),function(e){t.action_completed||("click"===e.type&&t.gantt.trigger_event("click",[t.task]),t.gantt.unselect_all(),t.group.classList.toggle("active"),t.show_popup())})}},{key:"show_popup",value:function(){var t=w.format(this.task.start,"MMM D",this.getOption("language")),e=w.format(w.add(this.task.end,-1,"second"),"MMM D",this.getOption("language")),i="".concat(t," - ").concat(e);this.gantt.show_popup({target_element:this.$bar,title:this.task.name,subtitle:i,task:this.task})}},{key:"set_action_completed",value:function(){var t=this;this.action_completed=!0,setTimeout(function(){t.action_completed=!1},1e3)}},{key:"compute_progress",value:function(){var t=this.$bar_progress.getWidth()/this.$bar.getWidth()*100;return parseInt(t,10)}},{key:"compute_x",value:function(){var t=this.getOption("step"),e=this.getOption("column_width"),i=this.task.start,n=this.gantt.grid.start,r=w.diff(i,n,"hour")/t*e;this.gantt.grid.view_is("Month")&&(r=w.diff(i,n,"day")*e/30);return r}},{key:"compute_y",value:function(){for(var t=0,e=this.getTasks().entries().indexOf(this.task),i=0;i<e;i++)t+=this.getTaskIdx([i]).height+this.getOption("padding");return this.getOption("header_height")+this.getOption("padding")+t}},{key:"update_label_position",value:function(){var t=this.$bar,e=this.group.querySelector(".bar-label");e.getBBox().width>t.getWidth()?(e.classList.add("big"),e.setAttribute("x",t.getX()+t.getWidth()+5)):(e.classList.remove("big"),e.setAttribute("x",t.getX()+t.getWidth()/2))}}]),r}();var E=function(t){o(r,M);var i=d(r);function r(t,n){var s;return e(this,r),(s=i.call(this,t)).start=w.parse(n.start),s.end=w.parse(n.end),s.progress=n.progress,s.name=n.name,s.height=n.height||s.getOption("bar_height"),s.milestones=n.milestones||[],s.custom_class=n.custom_class,w.diff(s.end,s.start,"year")>10&&(s.end=null),s.start||s.end||(s.start=w.today(),s.end=w.add(s.start,2,"day")),!s.start&&s.end&&(s.start=w.add(s.end,-2,"day")),s.start&&!s.end&&(s.end=w.add(s.start,2,"day")),w.get_date_values(s.end).slice(3).every(function(t){return 0===t})&&(s.end=w.add(s.end,24,"hour")),s.start&&s.end||(s.invalid=!0),s.id=n.id,s.id||(s.id=c(s).name+"_"+Math.random().toString(36).slice(2,12)),s}return n(r,[{key:"render",value:function(){this.milestone_group=k("g",{class:"milestone-wrapper ".concat(this.custom_class||""),"data-id":this.id}),this.make_bars(),this.make_milestones()}},{key:"make_bars",value:function(){var t=new x(this.gantt,this),e=this.getLayer("bar");e.appendChild(t.group),e.appendChild(this.milestone_group)}},{key:"make_milestones",value:function(){var t=this;this.$milestones=this.milestones.map(function(e){return new D(t.gantt,t,e)})}}]),r}(),S=function(t){o(r,M);var i=d(r);function r(t,n){var s;return e(this,r),(s=i.call(this,t)).tasks=n.map(function(e){return new E(t,e)}),s}return n(r,[{key:"getBoundingDates",value:function(){var t,e=null,i=null,n=v(this.tasks);try{for(n.s();!(t=n.n()).done;){var r=t.value;if((!e||r.start<e)&&(e=r.start),(!i||r.end>i)&&(i=r.end),r.milestones){var s,a=v(r.milestones);try{for(a.s();!(s=a.n()).done;){var o=s.value;o.date<e&&(e=o.date),o.date>i&&(i=o.date)}}catch(t){a.e(t)}finally{a.f()}}}}catch(t){n.e(t)}finally{n.f()}return{gantt_start:e,gantt_end:i}}},{key:"render",value:function(){this.tasks.forEach(function(t){return t.render()})}},{key:"getHeight",value:function(){var t,e=this.getOption("padding")*this.tasks.length,i=v(this.tasks);try{for(i.s();!(t=i.n()).done;){e+=t.value.height}}catch(t){i.e(t)}finally{i.f()}return e}},{key:"entries",value:function(){return this.tasks}}]),r}(),Y=function(){function t(i,n){e(this,t),this.parent=i,this.custom_html=n,this.make()}return n(t,[{key:"make",value:function(){this.parent.innerHTML='\n            <div class="title"></div>\n            <div class="subtitle"></div>\n            <div class="pointer"></div>\n        ',this.hide(),this.title=this.parent.querySelector(".title"),this.subtitle=this.parent.querySelector(".subtitle"),this.pointer=this.parent.querySelector(".pointer")}},{key:"show",value:function(t){if(!t.target_element)throw new Error("target_element is required to show popup");t.position||(t.position="left");var e,i=t.target_element;if(this.custom_html){var n=this.custom_html(t.task);n+='<div class="pointer"></div>',this.parent.innerHTML=n,this.pointer=this.parent.querySelector(".pointer")}else this.title.innerHTML=t.title,this.subtitle.innerHTML=t.subtitle,this.parent.style.width=this.parent.clientWidth+"px";i instanceof HTMLElement?e=i.getBoundingClientRect():i instanceof SVGElement&&(e=t.target_element.getBBox()),"left"===t.position&&(this.parent.style.left=e.x+(e.width+10)+"px",this.parent.style.top=e.y+"px",this.pointer.style.transform="rotateZ(90deg)",this.pointer.style.left="-7px",this.pointer.style.top="2px"),this.parent.style.opacity=1}},{key:"hide",value:function(){this.parent.style.opacity=0}}]),t}(),A={VIEW_MODE:{QUARTER_DAY:"Quarter Day",HALF_DAY:"Half Day",DAY:"Day",WEEK:"Week",MONTH:"Month",YEAR:"Year"}},H=function(t){o(r,M);var i=d(r);function r(t){var n;return e(this,r),(n=i.call(this,t)).start=null,n.end=null,n}return n(r,[{key:"render",value:function(){this.make_grid_background(),this.make_grid_rows(),this.make_grid_header(),this.make_grid_ticks(),this.make_grid_highlights(),this.make_dates()}},{key:"view_is",value:function(t){var e=this;return"string"==typeof t?this.getOption("view_mode")===t:!!Array.isArray(t)&&t.some(function(t){return e.getOption("view_mode")===t})}},{key:"setup_dates",value:function(){this.setup_gantt_dates(),this.setup_date_values()}},{key:"setup_gantt_dates",value:function(){var t=this.getTasks().getBoundingDates(),e=t.gantt_start,i=t.gantt_end;this.start=e,this.end=i,this.start=w.start_of(this.start,"day"),this.end=w.start_of(this.end,"day"),this.view_is([A.QUARTER_DAY,A.HALF_DAY])?(this.start=w.add(this.start,-7,"day"),this.end=w.add(this.end,7,"day")):this.view_is(A.MONTH)?(this.start=w.start_of(this.start,"year"),this.end=w.add(this.end,1,"year")):this.view_is(A.YEAR)?(this.start=w.add(this.start,-2,"year"),this.end=w.add(this.end,2,"year")):(this.start=w.add(this.start,-1,"month"),this.end=w.add(this.end,1,"month"))}},{key:"setup_date_values",value:function(){this.dates=[];for(var t=null;null===t||t<this.end;)t=t?this.view_is(A.YEAR)?w.add(t,1,"year"):this.view_is(A.MONTH)?w.add(t,1,"month"):w.add(t,this.getOption("step"),"hour"):w.clone(this.start),this.dates.push(t)}},{key:"make_grid_background",value:function(){var t=this.dates.length*this.getOption("column_width"),e=this.getTasks().getHeight(),i=this.getOption("header_height")+this.getOption("padding")+e;k("rect",{x:0,y:0,width:t,height:i,class:"grid-background",append_to:this.getLayer("grid")}),b.attr(this.gantt.$svg,{height:i,width:"100%"})}},{key:"make_grid_rows",value:function(){var t,e=k("g",{append_to:this.getLayer("grid")}),i=k("g",{append_to:this.getLayer("grid")}),n=this.dates.length*this.getOption("column_width"),r=this.getOption("header_height")+this.getOption("padding")/2,s=v(this.getTasks().entries());try{for(s.s();!(t=s.n()).done;){var a=(t.value.height||this.getOption("bar_height"))+this.getOption("padding");k("rect",{x:0,y:r,width:n,height:a,class:"grid-row",append_to:e}),k("line",{x1:0,y1:r+a,x2:n,y2:r+a,class:"row-line",append_to:i}),r+=a}}catch(t){s.e(t)}finally{s.f()}}},{key:"make_grid_header",value:function(){k("rect",{x:0,y:0,width:this.dates.length*this.getOption("column_width"),height:this.getOption("header_height")+10,class:"grid-header",append_to:this.getLayer("grid")})}},{key:"make_grid_ticks",value:function(){var t,e=0,i=this.getOption("header_height")+this.getOption("padding")/2,n=this.getTasks().getHeight(),r=v(this.dates);try{for(r.s();!(t=r.n()).done;){var s=t.value,a="tick";this.view_is(A.DAY)&&1===s.getDate()&&(a+=" thick"),this.view_is(A.WEEK)&&s.getDate()>=1&&s.getDate()<8&&(a+=" thick"),this.view_is(A.MONTH)&&(s.getMonth()+1)%3==0&&(a+=" thick"),k("path",{d:"M ".concat(e," ").concat(i," v ").concat(n),class:a,append_to:this.getLayer("grid")}),this.view_is(A.MONTH)?e+=w.get_days_in_month(s)*this.getOption("column_width")/30:e+=this.getOption("column_width")}}catch(t){r.e(t)}finally{r.f()}}},{key:"make_grid_highlights",value:function(){if(this.view_is(A.DAY)){var t=w.diff(w.today(),this.start,"hour")/this.getOption("step")*this.getOption("column_width"),e=this.getOption("column_width"),i=this.getTasks().getHeight();k("rect",{x:t,y:0,width:e,height:this.getOption("header_height")+this.getOption("padding")/2+i,class:"today-highlight",append_to:this.getLayer("grid")})}}},{key:"make_dates",value:function(){var t,e=v(this.get_dates_to_draw());try{for(e.s();!(t=e.n()).done;){var i=t.value;if(k("text",{x:i.lower_x,y:i.lower_y,innerHTML:i.lower_text,class:"lower-text",append_to:this.getLayer("date")}),i.upper_text){var n=k("text",{x:i.upper_x,y:i.upper_y,innerHTML:i.upper_text,class:"upper-text",append_to:this.getLayer("date")});n.getBBox().x2>this.getLayer("grid").getBBox().width&&n.remove()}}}catch(t){e.e(t)}finally{e.f()}}},{key:"get_dates_to_draw",value:function(){var t=this,e=null;return this.dates.map(function(i,n){var r=t.get_date_info(i,e,n);return e=i,r})}},{key:"get_date_info",value:function(t,e,i){e||(e=w.add(t,1,"year"));var n={"Quarter Day_lower":w.format(t,"HH",this.getOption("language")),"Half Day_lower":w.format(t,"HH",this.getOption("language")),Day_lower:t.getDate()!==e.getDate()?w.format(t,"D",this.getOption("language")):"",Week_lower:t.getMonth()!==e.getMonth()?w.format(t,"D MMM",this.getOption("language")):w.format(t,"D",this.getOption("language")),Month_lower:w.format(t,"MMMM",this.getOption("language")),Year_lower:w.format(t,"YYYY",this.getOption("language")),"Quarter Day_upper":t.getDate()!==e.getDate()?w.format(t,"D MMM",this.getOption("language")):"","Half Day_upper":t.getDate()!==e.getDate()?t.getMonth()!==e.getMonth()?w.format(t,"D MMM",this.getOption("language")):w.format(t,"D",this.getOption("language")):"",Day_upper:t.getMonth()!==e.getMonth()?w.format(t,"MMMM",this.getOption("language")):"",Week_upper:t.getMonth()!==e.getMonth()?w.format(t,"MMMM",this.getOption("language")):"",Month_upper:t.getFullYear()!==e.getFullYear()?w.format(t,"YYYY",this.getOption("language")):"",Year_upper:t.getFullYear()!==e.getFullYear()?w.format(t,"YYYY",this.getOption("language")):""},r={x:i*this.getOption("column_width"),lower_y:this.getOption("header_height"),upper_y:this.getOption("header_height")-25},s={"Quarter Day_lower":4*this.getOption("column_width")/2,"Quarter Day_upper":0,"Half Day_lower":2*this.getOption("column_width")/2,"Half Day_upper":0,Day_lower:this.getOption("column_width")/2,Day_upper:30*this.getOption("column_width")/2,Week_lower:0,Week_upper:4*this.getOption("column_width")/2,Month_lower:this.getOption("column_width")/2,Month_upper:12*this.getOption("column_width")/2,Year_lower:this.getOption("column_width")/2,Year_upper:30*this.getOption("column_width")/2};return{upper_text:n["".concat(this.getOption("view_mode"),"_upper")],lower_text:n["".concat(this.getOption("view_mode"),"_lower")],upper_x:r.x+s["".concat(this.getOption("view_mode"),"_upper")],upper_y:r.upper_y,lower_x:r.x+s["".concat(this.getOption("view_mode"),"_lower")],lower_y:r.lower_y}}}]),r}();return SVGElement.prototype.getX=function(){return+this.getAttribute("x")},SVGElement.prototype.getY=function(){return+this.getAttribute("y")},SVGElement.prototype.getWidth=function(){return+this.getAttribute("width")},SVGElement.prototype.getHeight=function(){return+this.getAttribute("height")},SVGElement.prototype.getEndX=function(){return this.getX()+this.getWidth()},function(){function t(i,n,r){e(this,t),this.setup_wrapper(i),this.setup_options(r),this.grid=new H(this),this.tasks=new S(this,n),this.change_view_mode(),this.bind_events()}return n(t,[{key:"setup_wrapper",value:function(t){var e,i;if("string"==typeof t&&(t=document.querySelector(t)),t instanceof HTMLElement)i=t,e=t.querySelector("svg");else{if(!(t instanceof SVGElement))throw new TypeError("Frappé Gantt only supports usage of a string CSS selector, HTML DOM element or SVG DOM element for the 'element' parameter");e=t}e?(this.$svg=e,this.$svg.classList.add("gantt")):this.$svg=k("svg",{append_to:i,class:"gantt"}),this.$container=document.createElement("div"),this.$container.classList.add("gantt-container"),this.$svg.parentElement.appendChild(this.$container),this.$container.appendChild(this.$svg),this.popup_wrapper=document.createElement("div"),this.popup_wrapper.classList.add("popup-wrapper"),this.$container.appendChild(this.popup_wrapper)}},{key:"setup_options",value:function(t){var e={header_height:50,column_width:30,step:24,view_modes:g(Object.values(A)),bar_height:20,bar_corner_radius:3,padding:18,view_mode:"Day",date_format:"YYYY-MM-DD",popup_trigger:"click",custom_popup_html:null,language:"en"};this.options=a(a({},e),t)}},{key:"refresh",value:function(t){this.tasks=new S(t,this.options),this.change_view_mode()}},{key:"change_view_mode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.view_mode;this.update_view_scale(t),this.grid.setup_dates(),this.render(),this.trigger_event("view_change",[t])}},{key:"update_view_scale",value:function(t){this.options.view_mode=t,t===A.DAY?(this.options.step=24,this.options.column_width=38):t===A.HALF_DAY?(this.options.step=12,this.options.column_width=38):t===A.QUARTER_DAY?(this.options.step=6,this.options.column_width=38):t===A.WEEK?(this.options.step=168,this.options.column_width=140):t===A.MONTH?(this.options.step=720,this.options.column_width=120):t===A.YEAR&&(this.options.step=8760,this.options.column_width=120)}},{key:"bind_events",value:function(){this.bind_grid_click()}},{key:"render",value:function(){this.clear(),this.setup_layers(),this.grid.render(),this.tasks.render(),this.set_width(),this.set_scroll_position()}},{key:"setup_layers",value:function(){this.layers={};for(var t=0,e=["grid","date","progress","bar","details"];t<e.length;t++){var i=e[t];this.layers[i]=k("g",{class:i,append_to:this.$svg})}}},{key:"set_width",value:function(){var t=this.$svg.getBoundingClientRect().width,e=this.$svg.querySelector(".grid .grid-row").getAttribute("width");t<e&&this.$svg.setAttribute("width",e)}},{key:"set_scroll_position",value:function(){var t=this.$svg.parentElement;if(t){var e=w.diff(this.get_oldest_starting_date(),this.grid.start,"hour")/this.options.step*this.options.column_width-this.options.column_width;t.scrollLeft=e}}},{key:"bind_grid_click",value:function(){var t=this;b.on(this.$svg,this.options.popup_trigger,".grid-row, .grid-header",function(){t.unselect_all(),t.hide_popup()})}},{key:"unselect_all",value:function(){g(this.$svg.querySelectorAll(".bar-wrapper")).forEach(function(t){t.classList.remove("active")})}},{key:"show_popup",value:function(t){this.popup||(this.popup=new Y(this.popup_wrapper,this.options.custom_popup_html)),this.popup.show(t)}},{key:"hide_popup",value:function(){return this.popup&&this.popup.hide()}},{key:"trigger_event",value:function(t,e){this.options["on_"+t]&&this.options["on_"+t].apply(null,e)}},{key:"get_oldest_starting_date",value:function(){return this.tasks.tasks.map(function(t){return t.start}).reduce(function(t,e){return e<=t?e:t})}},{key:"clear",value:function(){this.$svg.innerHTML=""}}]),t}()}();
